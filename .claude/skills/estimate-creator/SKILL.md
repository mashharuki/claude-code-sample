---
name: estimate-creator
description: 御見積書を作成するスキル。クライアント名、件名、項目、単価(原価)、粗利率から見積書を生成します。日付、支払条件などの情報も扱います。
---

# 御見積書作成スキル

## 概要
このスキルは、与えられた情報から正式な御見積書(Excelファイル)を作成します。
原価と粗利率から販売単価を自動計算し、プロフェッショナルな見積書を生成します。

## 使用タイミング
- ユーザーが「見積書を作成して」と依頼したとき
- クライアント向けの見積もりドキュメントが必要なとき
- 原価から販売価格を計算する必要があるとき

## 必要な情報

### 必須項目
- **日付**: 見積書の発行日(YYYYMMDD形式)
- **クライアント名**: 見積先の会社名または個人名
- **件名**: 見積もりの対象となる案件名
- **支払条件**: 例: 「納品後30日以内」「月末締め翌月末払い」など
- **項目**: 見積もりの明細行(複数可)
  - 項目名
  - 数量
  - 単位
  - 単価(原価) - **御見積書には記載しません**
  - 粗利率(%) - 例: 30% の場合は 30 と入力

### 計算ロジック
販売単価 = 原価 ÷ (1 - 粗利率/100)

例: 原価が10,000円、粗利率が30%の場合
- 販売単価 = 10,000 ÷ (1 - 0.30) = 10,000 ÷ 0.70 = 14,286円(四捨五入)

## 出力先
- ディレクトリ: `001_御見積書/`
- ファイル名: `YYYYMMDD_御見積書_{案件名}.xlsx`
- 例: `20231215_御見積書_ウェブサイト制作.xlsx`

## 処理フロー

1. **情報収集**: ユーザーから必要な情報をすべて収集
2. **単価計算**: 原価と粗利率から販売単価を計算
3. **Excel生成**: テンプレートを使用して見積書を作成
4. **ファイル保存**: 指定のディレクトリに保存
5. **確認**: 生成されたファイルパスをユーザーに報告

## セキュリティとコンプライアンス

**重要**: 原価情報は社外秘です
- 原価は**絶対に**見積書に記載しないこと
- 見積書に記載するのは「販売単価」のみ
- 計算過程でのみ原価を使用し、最終ドキュメントには含めない

## 技術実装

### 使用可能なツール
- `Read`: テンプレートファイルの読み込み
- `Write`: 新しい見積書ファイルの作成
- `Bash`: Pythonスクリプトの実行(openpyxlを使用)

### テンプレート
テンプレートファイルは以下に配置:
`.claude/skills/estimate-creator/templates/estimate_template.xlsx`

### Pythonスクリプト例
```python
from openpyxl import load_workbook
from datetime import datetime

def create_estimate(
    date: str,
    client_name: str,
    subject: str,
    payment_terms: str,
    items: list,
    gross_margin: float
):
    # 販売単価を計算
    for item in items:
        cost = item['unit_price']  # 原価
        margin_rate = gross_margin / 100
        item['selling_price'] = round(cost / (1 - margin_rate))

    # Excelファイルを生成
    # (実装の詳細)
```

## エラーハンドリング

- 粗利率が0%または100%以上の場合は警告
- 必須項目が欠けている場合はユーザーに確認
- ファイル名の重複がある場合は上書き確認

## 例

### 使用例1: シンプルな見積書
```
ユーザー: 見積書を作成してください
- 日付: 2024年1月15日
- クライアント: 株式会社サンプル
- 件名: ウェブサイト制作
- 支払条件: 納品後30日以内
- 項目:
  - デザイン作成 / 1式 / 原価50,000円 / 粗利率30%
  - コーディング / 1式 / 原価80,000円 / 粗利率30%
```

販売単価計算:
- デザイン: 50,000 ÷ 0.70 = 71,429円
- コーディング: 80,000 ÷ 0.70 = 114,286円

出力ファイル: `001_御見積書/20240115_御見積書_ウェブサイト制作.xlsx`

### 使用例2: 複数項目の見積書
```
ユーザー: 以下の条件で見積書を作成してください
- 日付: 20240201
- クライアント: ABC株式会社
- 件名: システム開発
- 支払条件: 月末締め翌月末払い
- 粗利率: 25%
- 項目:
  - 要件定義 / 40時間 / 時間 / 原価5,000円
  - 設計 / 80時間 / 時間 / 原価5,000円
  - 実装 / 200時間 / 時間 / 原価4,000円
  - テスト / 40時間 / 時間 / 原価4,000円
```

## 参考ファイル

- `templates/estimate_template.xlsx`: 見積書のExcelテンプレート
- `scripts/create_estimate.py`: 見積書生成用Pythonスクリプト

## 注意事項

1. **原価の機密性**: 原価情報は絶対に見積書に含めない
2. **計算精度**: 販売単価は四捨五入して整数にする
3. **ファイル命名**: 日付はYYYYMMDD形式を厳守
4. **テンプレート**: テンプレートファイルが存在しない場合は作成を促す
